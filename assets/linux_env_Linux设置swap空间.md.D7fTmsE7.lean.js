import{_ as e,o as s,c as p,a2 as c}from"./chunks/framework.BGfUC0LL.js";const h=JSON.parse('{"title":"Linux设置swap空间","description":"","frontmatter":{},"headers":[],"relativePath":"linux/env/Linux设置swap空间.md","filePath":"linux/env/Linux设置swap空间.md","lastUpdated":1770864474000}'),o={name:"linux/env/Linux设置swap空间.md"};function t(i,a,d,n,r,l){return s(),p("div",null,[...a[0]||(a[0]=[c('<h1 id="linux设置swap空间" tabindex="-1">Linux设置swap空间 <a class="header-anchor" href="#linux设置swap空间" aria-label="Permalink to &quot;Linux设置swap空间&quot;">​</a></h1><p>服务器上日常运行着静态博客+云笔记+jenkins的容器，jenkins用于gitee上托管的博客repo的ci/cd。当jenkins进行构建时，内存占用率会急剧升高，轻则容器宕机，重则服务器跟着一起boom。因此需要设置swap来缓解jenkins内存占用瞬时升高的状况。</p><h2 id="查看磁盘分区" tabindex="-1">查看磁盘分区 <a class="header-anchor" href="#查看磁盘分区" aria-label="Permalink to &quot;查看磁盘分区&quot;">​</a></h2><ul><li><code>df -h</code></li></ul><p><img src="https://storyxc.com/images/blog/image-20220310010316020.png" alt="image-20220310010316020"></p><p>Filesystem中<code>/dev/vda1</code>挂载点为<code>/</code>的就是我们的磁盘</p><blockquote><p>一般来说swap大小设置规则：</p><p>4G以内RAM，Swap设置为2倍RAM</p><p>4G-8GRAM，Swap设置等于内存大小</p><p>8G-64G，Swap设置为8G</p><p>64G-256G，Swap设置为16G</p></blockquote><h2 id="创建swap分区文件" tabindex="-1">创建Swap分区文件 <a class="header-anchor" href="#创建swap分区文件" aria-label="Permalink to &quot;创建Swap分区文件&quot;">​</a></h2><p>我这个是腾讯云4c 4G 80G的机器，这里swap设置为4G：<code>fallocate -l 4G /swap</code></p><h2 id="启用swap分区" tabindex="-1">启用Swap分区 <a class="header-anchor" href="#启用swap分区" aria-label="Permalink to &quot;启用Swap分区&quot;">​</a></h2><p>修改权限使文件只能root访问：<code>chmod 600 /swap</code></p><p>将文件标记为swap空间：<code>mkswap /swap</code></p><p>启用swap文件：<code>swapon /swap</code></p><p>验证交换是否可用：<code>swapon --show</code></p><h2 id="持久化swap挂载" tabindex="-1">持久化swap挂载 <a class="header-anchor" href="#持久化swap挂载" aria-label="Permalink to &quot;持久化swap挂载&quot;">​</a></h2><p>备份fstab：<code>cp /etc/fstab /etc/fstab.bak</code></p><p>添加一条记录： <code>echo &#39;/swapfile none swap sw 0 0&#39; | sudo tee -a /etc/fstab</code></p><h2 id="调整swap设置" tabindex="-1">调整Swap设置 <a class="header-anchor" href="#调整swap设置" aria-label="Permalink to &quot;调整Swap设置&quot;">​</a></h2><ul><li>swappiness</li></ul><p>调整Swappiness参数，该参数主要配置系统将数据从RAM交换到交换空间的频率。该参数的值是介于0和100之间的百分比。范围在0到100之间。 低参数值会让内核尽量少用交换，更高参数值会使内核更多的去使用交换空间。</p><p>查看当前swappiness值：<code>cat /proc/sys/vm/swappiness</code></p><p>临时修改，重启失效：<code>sysctl vm.swappiness=10</code></p><p>永久设置：<code>vim /etc/sysctl.conf</code>，最后一行加上<code>vm.swappiness=10</code>，保存并退出。<code>sysctl -p </code>立即生效</p><ul><li>vfs_cache_pressure 表示强制Linux VM最低保留多少空闲内存（Kbytes）。当可用内存低于这个参数时，系统开始回收cache内存，以释放内存，直到可用内存大于这个值。 查看 <code>cat /proc/sys/vm/vfs_cache_pressure</code> 缺省值100表示内核将根据pagecache和swapcache，把directory和inode cache保持在一个合理的百分比；降低该值低于100，将导致内核倾向于保留directory和inode cache；增加该值超过100，将导致内核倾向于回收directory和inode cache。</li></ul><p><code>vim /etc/sysctl.conf</code>，最后一行加上<code>vm.vfs_cache_pressure=50</code></p>',25)])])}const u=e(o,[["render",t]]);export{h as __pageData,u as default};
