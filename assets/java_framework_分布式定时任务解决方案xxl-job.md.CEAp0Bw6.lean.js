import{_ as a,o as i,c as o,a2 as e}from"./chunks/framework.BGfUC0LL.js";const _=JSON.parse('{"title":"分布式定时任务解决方案xxl-job","description":"","frontmatter":{},"headers":[],"relativePath":"java/framework/分布式定时任务解决方案xxl-job.md","filePath":"java/framework/分布式定时任务解决方案xxl-job.md","lastUpdated":1770864474000}'),t={name:"java/framework/分布式定时任务解决方案xxl-job.md"};function p(r,l,x,s,n,c){return i(),o("div",null,[...l[0]||(l[0]=[e('<h1 id="分布式定时任务解决方案xxl-job" tabindex="-1">分布式定时任务解决方案xxl-job <a class="header-anchor" href="#分布式定时任务解决方案xxl-job" aria-label="Permalink to &quot;分布式定时任务解决方案xxl-job&quot;">​</a></h1><h2 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-label="Permalink to &quot;背景&quot;">​</a></h2><p>今天领导让我了解下分布式定时任务的内容,对项目中目前的定时任务改造一下,公司目前项目中封装的定时任务注解是基于spring的scheduler的,单机环境下没问题,但是为了服务的高可用生产都是集群部署的,会导致任务多次运行的问题,上家公司用的ssm,定时任务选型是Quartz,生产上采用的quartz的集群部署,quartz集群是不会出现任务重复执行的,原理跟下文讲到的xxl-job一样都是通过数据库表来加锁实现</p><h2 id="xxl-job" tabindex="-1">xxl-job <a class="header-anchor" href="#xxl-job" aria-label="Permalink to &quot;xxl-job&quot;">​</a></h2><p>Xxl-job官网:<a href="https://www.xuxueli.com/xxl-job/" target="_blank" rel="noreferrer">https://www.xuxueli.com/xxl-job/</a></p><p>XXL-JOB是一个分布式任务调度平台，其核心设计目标是开发迅速、学习简单、轻量级、易扩展。现已开放源代码并接入多家公司线上产品线，开箱即用。</p><p>选择xxl-job的原因有以下几点:</p><ul><li>调度和任务解耦,有单独的调度中心及控制台</li><li>代码易扩展</li><li>实现的功能比较全面</li></ul><p>使用流程:</p><ul><li><p>执行doc中的sql脚本,建相关的库表,具体表的作用可阅读帮助文档</p></li><li><p>修改xxl-job-admin配置文件后可以直接启动admin应用</p></li><li><p>修改执行器应用中配置文件,注意匹配admin的相关信息</p></li><li><p>copy一份示例执行器的代码 修改应用端口和执行端口</p></li><li><p>启动两个示例执行器应用(模拟集群)</p></li><li><p>打开控制台可以看到已经注册上了两个节点 <img src="https://storyxc.com/images/blog//Snipaste_2021-03-18_20-18-51.png" alt="Snipaste_20210318_201851.png"></p></li><li><p>在控制台任务管理中修改任务的相关信息,这里只试个最简单的,更多高级配置请看使用文档</p></li></ul><p><img src="https://storyxc.com/images/blog//Snipaste_2021-03-18_20-21-27.png" alt="Snipaste_20210318_202127.png"></p><p><img src="https://storyxc.com/images/blog//Snipaste_2021-03-18_20-22-18.png" alt="Snipaste_20210318_202218.png"></p><p><img src="https://storyxc.com/images/blog//Snipaste_2021-03-18_20-22-26.png" alt="Snipaste_20210318_202226.png"></p><p>可以在控制台的调度记录中看到,集群模式下任务也只执行了一次.</p><p>除了cron任务,xxl-job中还支持周期性的任务,shell任务等.路由策略还支持轮询,一致性哈希,故障转移等,在admin中配置好java.mail信息,在控制配置任务时添加告警邮件,在任务调度出现异常时还会邮件告警</p><p>集成到微服务系统的思路:</p><ul><li>数据库建表</li><li>新建一个job-admin服务将xxl-job-admin迁移,修改配置信息</li><li>在需要定时任务的业务服务中引入xxl-core依赖</li><li>在任务类中实现业务逻辑,任务方法上加上@XxlJob(value = &quot;xxHandler&quot;)</li><li>admin服务启动后启动具体的业务服务</li><li>在调度中心新建任务,配置相关信息,注意JobHandler的值为@XxlJob注解的Value</li></ul>',17)])])}const b=a(t,[["render",p]]);export{_ as __pageData,b as default};
