import{_ as a,c as e,o as n,a2 as i}from"./chunks/framework.CQECOx-R.js";const c=JSON.parse('{"title":"ubuntu-server开启网络唤醒和通电自动启动","description":"","frontmatter":{},"headers":[],"relativePath":"tinker/network/ubuntu-server开启网络唤醒.md","filePath":"tinker/network/ubuntu-server开启网络唤醒.md","lastUpdated":1746516944000}'),l={name:"tinker/network/ubuntu-server开启网络唤醒.md"};function t(p,s,h,o,r,k){return n(),e("div",null,s[0]||(s[0]=[i(`<h1 id="ubuntu-server开启网络唤醒和通电自动启动" tabindex="-1">ubuntu-server开启网络唤醒和通电自动启动 <a class="header-anchor" href="#ubuntu-server开启网络唤醒和通电自动启动" aria-label="Permalink to &quot;ubuntu-server开启网络唤醒和通电自动启动&quot;">​</a></h1><h2 id="前提" tabindex="-1">前提 <a class="header-anchor" href="#前提" aria-label="Permalink to &quot;前提&quot;">​</a></h2><p>主板支持WOL（Wake on LAN）功能和来电开机</p><h2 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-label="Permalink to &quot;配置&quot;">​</a></h2><h3 id="主板bios中开启网络唤醒功能和断电开机功能" tabindex="-1">主板BIOS中开启网络唤醒功能和断电开机功能 <a class="header-anchor" href="#主板bios中开启网络唤醒功能和断电开机功能" aria-label="Permalink to &quot;主板BIOS中开启网络唤醒功能和断电开机功能&quot;">​</a></h3><blockquote><p><a href="https://endownload.colorful.cn/EnDownload/MotherBroard/2022/Intel%20600/Manual/Intel%20600%20Series%20BIOS%20Chinese/Intel%20600%20Series%20BIOS%20User%20Guide.pdf" target="_blank" rel="noreferrer">https://endownload.colorful.cn/EnDownload/MotherBroard/2022/Intel 600/Manual/Intel 600 Series BIOS Chinese/Intel 600 Series BIOS User Guide.pdf</a></p></blockquote><p>以七彩虹主板为例</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>ADVANCED（高级模式）&gt; Power Management Configuration（电源管理配置）&gt; Wake By Lan（网卡唤醒）</span></span>
<span class="line"><span>Wake By Lan（网卡唤醒） </span></span>
<span class="line"><span>设置网络唤醒功能。 </span></span>
<span class="line"><span>[Enabled] 当检测到 LAN 设备已激活或有信号输入时，唤醒系统。 </span></span>
<span class="line"><span>[Disabled] 关闭网络唤醒功能。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>ADVANCED（高级模式）&gt; Power Management Configuration（电源管理配置）&gt; AC Power Loss（断电开机功能） </span></span>
<span class="line"><span>AC Power Loss（断电开机功能） </span></span>
<span class="line"><span>设置计算机断电之后，电源再次被接通时计算机的响应状态。 </span></span>
<span class="line"><span>[Power On] 通电后计算机自动开机。 </span></span>
<span class="line"><span>[Power Off] 通电后计算机保持关机状态。 </span></span>
<span class="line"><span>[Last State]] 通电后计算机恢复上次断电前的状态。</span></span></code></pre></div><h3 id="ubuntu-server中开启网卡的网络唤醒功能" tabindex="-1">ubuntu-server中开启网卡的网络唤醒功能 <a class="header-anchor" href="#ubuntu-server中开启网卡的网络唤醒功能" aria-label="Permalink to &quot;ubuntu-server中开启网卡的网络唤醒功能&quot;">​</a></h3><h4 id="使用ethtool查看信息" tabindex="-1">使用ethtool查看信息 <a class="header-anchor" href="#使用ethtool查看信息" aria-label="Permalink to &quot;使用ethtool查看信息&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果没有需要先安装 apt install ethtool</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 首先使用ifconfig或ip a查看设备名称 我的是enp3s0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ethtool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enp3s0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Wake-on&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	Supports</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Wake-on:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pumbg</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	Wake-on:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> d</span></span></code></pre></div><p>这个信息说明支持pumbg几种唤醒方式，而d表示当前处于禁用状态</p><blockquote><p>&quot;Wake-on&quot; 中的不同字母代表不同的唤醒模式 这些字母分别代表以下内容：</p><ul><li><code>p</code>：代表PHY（物理层）唤醒模式，这种模式是基于物理层的唤醒模式。</li><li><code>u</code>：代表UDP数据包唤醒模式，这种模式需要特定的UDP数据包来唤醒设备。</li><li><code>m</code>：代表多播唤醒模式，这允许多播数据包来唤醒设备。</li><li><code>b</code>：代表广播唤醒模式，这允许广播数据包来唤醒设备。</li><li><code>g</code>：代表魔术唤醒帧模式，这是一种常用的唤醒模式，需要特定的魔术唤醒数据包。</li></ul><blockquote><p>魔术唤醒数据包（Magic Wake-on-LAN Packet）是一种特殊的数据包，用于远程唤醒计算机或网络设备。它通常用于通过局域网远程唤醒处于休眠或关机状态的设备，以便进行远程管理或访问。这些数据包被称为&quot;魔术&quot;，因为它们包含了一些特定的唤醒模式信息，以便网络接口卡能够识别并唤醒目标设备。</p><p>魔术唤醒数据包的结构通常包括以下元素：</p><ol><li>目标设备的MAC地址：这是数据包的目标设备的物理地址，以便网络接口卡知道唤醒哪台设备。</li><li>以太网帧：数据包以标准的以太网帧格式进行封装。</li><li>魔术唤醒模式信息：这些信息告诉网络接口卡以特定方式处理数据包，以实现唤醒功能。</li></ol></blockquote></blockquote><h4 id="启用网络唤醒功能" tabindex="-1">启用网络唤醒功能 <a class="header-anchor" href="#启用网络唤醒功能" aria-label="Permalink to &quot;启用网络唤醒功能&quot;">​</a></h4><p><code>ethtool -s enp3s0 wol g</code></p><h4 id="重启后网络唤醒会失效-配置网络唤醒持久化" tabindex="-1">重启后网络唤醒会失效，配置网络唤醒持久化 <a class="header-anchor" href="#重启后网络唤醒会失效-配置网络唤醒持久化" aria-label="Permalink to &quot;重启后网络唤醒会失效，配置网络唤醒持久化&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> edit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --force</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --full</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wol-enable.service</span></span></code></pre></div><blockquote><p>可以使用update-alternatives --config editor修改默认编辑器</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Enable</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Wake-on-LAN</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ExecStart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/usr/sbin/ethtool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enp3s0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> g</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">WantedBy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">multi-user.target</span></span></code></pre></div><p><code>systemctl daemon-reload &amp;&amp; systemctl enable wol-enable.service &amp;&amp; systemctl start wol-enable.service</code></p><h4 id="网络唤醒调用" tabindex="-1">网络唤醒调用 <a class="header-anchor" href="#网络唤醒调用" aria-label="Permalink to &quot;网络唤醒调用&quot;">​</a></h4><p>不同平台都有相对应的唤醒客户端，我主要是从软路由使用这个功能。使用Etherwake选中要唤醒的设备点击唤醒主机即可发送数据包成功唤醒。</p><p><img src="https://storyxc.com/images/blog/750e2910-db92-4650-9167-3a2eee4be968.png" alt="image-20231020231608248"></p><h4 id="来电自启" tabindex="-1">来电自启 <a class="header-anchor" href="#来电自启" aria-label="Permalink to &quot;来电自启&quot;">​</a></h4><p>可以配合UPS使用实现断电安全关机以及来电自动启动，详情见另一篇关于UPS和NUT的博客。</p>`,25)]))}const u=a(l,[["render",t]]);export{c as __pageData,u as default};
