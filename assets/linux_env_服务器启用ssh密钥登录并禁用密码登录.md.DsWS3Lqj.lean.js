import{_ as a,o as i,c as e,a2 as h}from"./chunks/framework.BGfUC0LL.js";const c=JSON.parse('{"title":"服务器启用ssh密钥登录并禁用密码登录","description":"","frontmatter":{},"headers":[],"relativePath":"linux/env/服务器启用ssh密钥登录并禁用密码登录.md","filePath":"linux/env/服务器启用ssh密钥登录并禁用密码登录.md","lastUpdated":1770864474000}'),n={name:"linux/env/服务器启用ssh密钥登录并禁用密码登录.md"};function t(l,s,p,k,d,r){return i(),e("div",null,[...s[0]||(s[0]=[h(`<h1 id="服务器启用ssh密钥登录并禁用密码登录" tabindex="-1">服务器启用ssh密钥登录并禁用密码登录 <a class="header-anchor" href="#服务器启用ssh密钥登录并禁用密码登录" aria-label="Permalink to &quot;服务器启用ssh密钥登录并禁用密码登录&quot;">​</a></h1><blockquote><p>There were 89 failed login attempts since the last successful login.</p></blockquote><p>最近登录阿里云服务器，总是发现有人恶意尝试登录，虽然密码强度很高，但是看着就闹心，索性把密码登录给ban掉改用密钥登录。</p><h2 id="生成密钥对" tabindex="-1">生成密钥对 <a class="header-anchor" href="#生成密钥对" aria-label="Permalink to &quot;生成密钥对&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;邮箱地址&quot;</span></span></code></pre></div><p>此时会在/root/.ssh下生成id_rsa和id_rsa.pub的私钥和公钥</p><h2 id="服务器安装公钥" tabindex="-1">服务器安装公钥 <a class="header-anchor" href="#服务器安装公钥" aria-label="Permalink to &quot;服务器安装公钥&quot;">​</a></h2><p>使用<code>ssh-copy-id</code>命令将公钥拷贝到服务器上</p><blockquote><p>把本地的ssh公钥文件安装到远程主机对应的账户下,ssh-copy-id命令 可以把本地主机的公钥复制到远程主机的authorized_keys文件上，ssh-copy-id命令也会给远程主机的用户主目录（home）和~/.ssh, 和~/.ssh/authorized_keys设置合适的权限。 ssh-copy-id 用来将本地公钥复制到远程主机。如果不传入 -i 参数，ssh-copy-id 使用默认 ~/.ssh/identity.pub 作为默认公钥。如果多次运行 ssh-copy-id ，该命令不会检查重复，会在远程主机中多次写入 authorized_keys 。</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-copy-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [-i </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">identify_file]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [user@]host</span></span></code></pre></div><h3 id="修改ssh登录设置" tabindex="-1">修改ssh登录设置 <a class="header-anchor" href="#修改ssh登录设置" aria-label="Permalink to &quot;修改ssh登录设置&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/ssh/sshd_config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RSAAuthentication</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PubkeyAuthentication</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AuthorizedKeysFile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .ssh/authorized_keys</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PasswordAuthentication</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #密码登录 此时不要关闭</span></span></code></pre></div><p>修改并保存，重启sshd服务<code>systemctl restart sshd</code></p><h2 id="设置私钥权限" tabindex="-1">设置私钥权限 <a class="header-anchor" href="#设置私钥权限" aria-label="Permalink to &quot;设置私钥权限&quot;">​</a></h2><p>id_rsa文件权限需要调整，否则使用密钥登录会因为私钥文件权限问题被拒绝。</p><p>一般来说： .ssh目录设置700权限 id_rsa,authorized_keys文件设置600权限 id_rsa.pub,known_hosts文件设置644权限</p><h2 id="修改登录命令" tabindex="-1">修改登录命令 <a class="header-anchor" href="#修改登录命令" aria-label="Permalink to &quot;修改登录命令&quot;">​</a></h2><p>登录使用<code>ssh -i &quot;私钥文件全路径&quot; root@xxx.xxx.xxx.xxx</code></p><h2 id="尝试登录" tabindex="-1">尝试登录 <a class="header-anchor" href="#尝试登录" aria-label="Permalink to &quot;尝试登录&quot;">​</a></h2><p><img src="https://storyxc.com/images/blog//image-20211218211917959.png" alt="image-20211218211917959"></p><p>登录成功</p><h2 id="关闭云服务器" tabindex="-1">关闭云服务器 <a class="header-anchor" href="#关闭云服务器" aria-label="Permalink to &quot;关闭云服务器&quot;">​</a></h2><p>密钥登录成功后即可关闭服务器的密码登录</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/ssh/sshd_config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PasswordAuthentication</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #关闭密码登录</span></span></code></pre></div><p>保存后重启sshd服务<code>systemctl restart sshd</code></p><h2 id="尝试密码登录" tabindex="-1">尝试密码登录 <a class="header-anchor" href="#尝试密码登录" aria-label="Permalink to &quot;尝试密码登录&quot;">​</a></h2><p><img src="https://storyxc.com/images/blog//image-20211218212154923.png" alt="image-20211218212154923"></p><p>可以看到密码登录已经被关闭</p><h2 id="手动配置ssh密钥" tabindex="-1">手动配置ssh密钥 <a class="header-anchor" href="#手动配置ssh密钥" aria-label="Permalink to &quot;手动配置ssh密钥&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">adduser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> username</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/username/.ssh</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编辑authorized_keys文件，将生成的公钥添加进去</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/username/.ssh/authorized_keys</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> username:username</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/username.ssh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 700</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/username/.ssh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 600</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/username/.ssh/authorized_keys</span></span></code></pre></div>`,30)])])}const F=a(n,[["render",t]]);export{c as __pageData,F as default};
