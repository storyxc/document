import{_ as a,o as i,c as n,a2 as t}from"./chunks/framework.BGfUC0LL.js";const g=JSON.parse('{"title":"Grafana","description":"","frontmatter":{},"headers":[],"relativePath":"linux/applications/Grafana.md","filePath":"linux/applications/Grafana.md","lastUpdated":1770864474000}'),e={name:"linux/applications/Grafana.md"};function l(h,s,p,k,r,d){return i(),n("div",null,[...s[0]||(s[0]=[t(`<h1 id="grafana" tabindex="-1">Grafana <a class="header-anchor" href="#grafana" aria-label="Permalink to &quot;Grafana&quot;">​</a></h1><h2 id="告警" tabindex="-1">告警 <a class="header-anchor" href="#告警" aria-label="Permalink to &quot;告警&quot;">​</a></h2><p>grafana的告警可以使用Go Template语法来读取内置的变量数据并输出到告警邮件中</p><p>比如alert query从Loki日志中查询，可以同时从日志中提取出自己需要的关键属性作为标签:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">count_over_time(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{job=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;wechat&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">订单申请退款失败</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pattern</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">_</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orderNo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">orderNo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> refundNo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">refundNo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [1m])</span></span></code></pre></div><p>上面的查询提取了订单号、退款单号的数据，标签会存在<code>_value_string_</code>中，可以使用$values访问，在Summary中填写以下模板：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{ with $values }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $k, $v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  订单编号: {{$v.Labels.orderNo}}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  退款单号: {{$v.Labels.refundNo}}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  服务器实例: {{$v.Labels.instance}}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{ end }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{ end }}</span></span></code></pre></div><blockquote><p><a href="https://community.grafana.com/t/how-to-use-alert-message-templates-in-grafana/67537/3" target="_blank" rel="noreferrer">https://community.grafana.com/t/how-to-use-alert-message-templates-in-grafana/67537/3</a></p></blockquote><h2 id="匿名访问" tabindex="-1">匿名访问 <a class="header-anchor" href="#匿名访问" aria-label="Permalink to &quot;匿名访问&quot;">​</a></h2><ul><li>首先在Administration中创建新的组织<code>Guest</code></li><li>修改配置文件</li></ul><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># grafana.ini</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[auth.anonymous]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># enable anonymous access</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># specify organization name that should be used for unauthenticated users</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">org_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = Guest</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># specify role for unauthenticated users</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">org_role</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = Viewer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># mask the Grafana version number for unauthenticated users</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">hide_version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = true</span></span></code></pre></div>`,11)])])}const c=a(e,[["render",l]]);export{g as __pageData,c as default};
