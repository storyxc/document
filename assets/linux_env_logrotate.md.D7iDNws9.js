import{_ as a,c as i,o as t,a2 as n}from"./chunks/framework.CQECOx-R.js";const d=JSON.parse('{"title":"logrotate","description":"","frontmatter":{},"headers":[],"relativePath":"linux/env/logrotate.md","filePath":"linux/env/logrotate.md","lastUpdated":1746516944000}'),e={name:"linux/env/logrotate.md"};function l(h,s,p,o,r,k){return t(),i("div",null,s[0]||(s[0]=[n(`<h1 id="logrotate" tabindex="-1">logrotate <a class="header-anchor" href="#logrotate" aria-label="Permalink to &quot;logrotate&quot;">​</a></h1><h2 id="介绍" tabindex="-1">介绍 <a class="header-anchor" href="#介绍" aria-label="Permalink to &quot;介绍&quot;">​</a></h2><p>logrotate 是 Linux 下用于 管理日志文件自动轮转、压缩、删除 的工具。它可以 防止日志文件无限增长，占满磁盘空间，并支持 定期清理旧日志。</p><p><strong>日志轮转（Rotate）</strong>：定期创建新日志，并重命名旧日志。</p><p><strong>日志压缩（Compress）</strong>：轮转后自动使用 gzip 等压缩旧日志，减少磁盘占用。</p><p><strong>删除过旧日志（Remove）</strong>：可设置 <strong>保留 X 天的日志</strong>，超过的自动删除。</p><p><strong>限制日志大小（Size-based Rotation）</strong>：可以设定 <strong>当日志达到一定大小时轮转</strong>。</p><p><strong>自动执行（Cron 任务）</strong>：一般会 <strong>每天由系统自动运行</strong>。</p><p><strong>轮转后执行命令（postrotate）</strong>：轮转完成后可 <strong>重启 Nginx、Apache、MySQL 等服务</strong>，让它们重新生成日志文件。</p><h3 id="运行方式" tabindex="-1"><strong>运行方式</strong> <a class="header-anchor" href="#运行方式" aria-label="Permalink to &quot;**运行方式**&quot;">​</a></h3><p>logrotate <strong>通常由 cron 定时执行</strong>，默认每天检查一次，位于：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/cron.daily/logrotate</span></span></code></pre></div><p>也可以手动执行</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">logrotate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/logrotate.d/nginx</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 立即轮转 nginx 日志</span></span></code></pre></div><h3 id="配置文件" tabindex="-1"><strong>配置文件</strong> <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;**配置文件**&quot;">​</a></h3><p>logrotate <strong>主配置文件</strong> 位于：<code>/etc/logrotate.conf</code></p><p><strong>各服务的独立日志规则</strong> 通常在：<code>/etc/logrotate.d/</code></p><p>如：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/logrotate.d/nginx</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Nginx 日志轮转</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/logrotate.d/mysql</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # MySQL 日志轮转</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/logrotate.d/syslog</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 系统日志轮转</span></span></code></pre></div><h3 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h3><h4 id="nginx日志轮转" tabindex="-1">nginx日志轮转 <a class="header-anchor" href="#nginx日志轮转" aria-label="Permalink to &quot;nginx日志轮转&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/data/wwwlogs/nginx/*.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    daily</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 每天轮转日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    missingok</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 如果日志文件不存在，不报错</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rotate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 只保留最近 14 天的日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    compress</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             # 轮转后压缩（默认 gzip）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    delaycompress</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 延迟一轮再压缩，避免日志仍在写入时被压缩</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    notifempty</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           # 如果日志为空，则不轮转</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0640</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> adm</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 轮转后创建新日志，权限 0640，root 拥有，adm 组可读</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    dateext</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              # 旧日志文件加上日期后缀（access.log.2024-03-20）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    dateformat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .%Y-%m-%d</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 日期后缀格式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    postrotate</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           # 轮转后执行命令，重启 Nginx 日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        /bin/kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -USR1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/nginx.pid\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    endscript</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="手动执行logrotate" tabindex="-1">手动执行logrotate <a class="header-anchor" href="#手动执行logrotate" aria-label="Permalink to &quot;手动执行logrotate&quot;">​</a></h3><h4 id="测试配置" tabindex="-1">测试配置 <a class="header-anchor" href="#测试配置" aria-label="Permalink to &quot;测试配置&quot;">​</a></h4><p><code>logrotate -d /etc/logrotate.d/nginx</code></p><h4 id="强制执行轮转" tabindex="-1">强制执行轮转 <a class="header-anchor" href="#强制执行轮转" aria-label="Permalink to &quot;强制执行轮转&quot;">​</a></h4><p><code>logrotate -f /etc/logrotate.d/nginx</code></p>`,27)]))}const c=a(e,[["render",l]]);export{d as __pageData,c as default};
