import{_ as a,c as i,o as t,a2 as e}from"./chunks/framework.CQECOx-R.js";const g=JSON.parse('{"title":"安装PVE虚拟机并在PVE安装truenas","description":"","frontmatter":{},"headers":[],"relativePath":"tinker/vm/安装PVE虚拟机并在PVE安装truenas.md","filePath":"tinker/vm/安装PVE虚拟机并在PVE安装truenas.md","lastUpdated":1746516944000}'),p={name:"tinker/vm/安装PVE虚拟机并在PVE安装truenas.md"};function l(n,s,h,r,o,k){return t(),i("div",null,s[0]||(s[0]=[e(`<h1 id="安装pve虚拟机并在pve安装truenas" tabindex="-1">安装PVE虚拟机并在PVE安装truenas <a class="header-anchor" href="#安装pve虚拟机并在pve安装truenas" aria-label="Permalink to &quot;安装PVE虚拟机并在PVE安装truenas&quot;">​</a></h1><h2 id="安装pve" tabindex="-1">安装PVE <a class="header-anchor" href="#安装pve" aria-label="Permalink to &quot;安装PVE&quot;">​</a></h2><h3 id="制作系统安装盘" tabindex="-1">制作系统安装盘 <a class="header-anchor" href="#制作系统安装盘" aria-label="Permalink to &quot;制作系统安装盘&quot;">​</a></h3><ol><li>下载rufus</li><li>下载pve最新镜像</li><li>rufus选择镜像并刷写到自己的U盘中</li></ol><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>一般的系统选择iso镜像模式写入，安装pve需要选择dd镜像模式写入</p></div><h3 id="安装系统" tabindex="-1">安装系统 <a class="header-anchor" href="#安装系统" aria-label="Permalink to &quot;安装系统&quot;">​</a></h3><p>等待刷写完毕按照正常U盘安装系统流程安装，注意ip网关等配置即可</p><h2 id="pve中安装truenas-scale" tabindex="-1">PVE中安装Truenas Scale <a class="header-anchor" href="#pve中安装truenas-scale" aria-label="Permalink to &quot;PVE中安装Truenas Scale&quot;">​</a></h2><h3 id="上传iso镜像" tabindex="-1">上传iso镜像 <a class="header-anchor" href="#上传iso镜像" aria-label="Permalink to &quot;上传iso镜像&quot;">​</a></h3><p>官网下载truenas scale系统镜像，打开pve的配置地址，点击上传后选择下载好的镜像文件并上传</p><p><img src="https://storyxc.com/images/blog/image-20220424104118496.png" alt="image-20220424104118496"></p><h2 id="创建虚拟机" tabindex="-1">创建虚拟机 <a class="header-anchor" href="#创建虚拟机" aria-label="Permalink to &quot;创建虚拟机&quot;">​</a></h2><p><img src="https://storyxc.com/images/blog/image-20220424104248209.png" alt="image-20220424104248209"></p><p>操作系统选择刚上传的镜像</p><p><img src="https://storyxc.com/images/blog/image-20220424104316127.png" alt="image-20220424104316127"></p><p>系统tab页默认即可，磁盘这里要注意<strong>总线/设备选择sata0，磁盘大小选择16即可，这里是分了一个虚拟的系统盘，不需要太大，因为truenas系统的系统引导盘和存储是分开的，分的太大在truenas中也无法用于存储</strong></p><p><img src="https://storyxc.com/images/blog/image-20220424104359163.png" alt="image-20220424104359163"></p><p>cpu根据情况设置，内存最小8G，建议尽可能大，truenas scale官方建议最好16G，因为truenas的文件系统很依赖内存。</p><h3 id="安装truenas" tabindex="-1">安装truenas <a class="header-anchor" href="#安装truenas" aria-label="Permalink to &quot;安装truenas&quot;">​</a></h3><p>启动刚创建的虚拟机，在选择系统安装盘界面按空格选中刚分配的16G磁盘，选择ok即可</p><p><img src="https://storyxc.com/images/blog/image-20220424104822972.png" alt="image-20220424104822972"></p><p>然后输入root密码，安装完后选择3重启</p><p><img src="https://storyxc.com/images/blog/image-20220424104905506.png" alt="image-20220424104905506"></p><p>随后等待系统安装完毕</p><p><img src="https://storyxc.com/images/blog/image-20220424104940291.png" alt="image-20220424104940291"></p><p>输入9选择关机</p><h3 id="给truenas分配存储盘" tabindex="-1">给truenas分配存储盘 <a class="header-anchor" href="#给truenas分配存储盘" aria-label="Permalink to &quot;给truenas分配存储盘&quot;">​</a></h3><ol><li>最简单的办法，直接添加虚拟硬盘</li></ol><p><img src="https://storyxc.com/images/blog/image-20220424105115934.png" alt="image-20220424105115934"></p><p>总线这里序号会默认自增，存储选择磁盘，我这里是只有一个固态硬盘，磁盘大小根据实际情况选择即可，添加即完成了虚拟硬盘的添加。</p><p><img src="https://storyxc.com/images/blog/image-20220424105147413.png" alt="image-20220424105147413"></p><ol start="2"><li><p>硬盘直通</p><p>1）直通单个硬盘</p><p>因为我这台测试机器只有一个固态硬盘，pve系统也装在这上面，所以无法用硬盘的直通，如果有多个机械盘，想直通给truenas，可以使用以下命令</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/disk/by-id</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 查看硬盘名称</span></span></code></pre></div><p><img src="https://storyxc.com/images/blog/image-20220424105554763.png" alt="image-20220424105554763"></p><p>这里sda对应就是我的唯一一个硬盘，后面的sda1、2、3都是分区，可以忽略，记录下磁盘名称ata-WDC_WD10EZEX-08WN4A0_WD-WCC6Y6EDC1NT，执行命令进行直通</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sata1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/disk/by-id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ata-WDC_WD10EZEX-08WN4A0_WD-WCC6Y6EDC1NT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">返回</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> VM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 100:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sata1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/disk/by-id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ata-WDC_WD10EZEX-08WN4A0_WD-WCC6Y6EDC1NT</span></span></code></pre></div><p>看到这个返回信息即为直通成功，回到虚拟机下面可以看到已经新增了一个sata硬盘</p><p>命令拆解：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vm编号</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -总线编号</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 磁盘路径</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vm编号为pve虚拟机中的编号，例如100，101，102等</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 总线编号为指定编号下要新增的硬盘总线编号，例如虚拟机下只有一个硬盘sata0，要新增的就是sata1，这里就要填sata1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 磁盘路径</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 就是/dev/disk/by-id/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 我们上一步保存的硬盘名称</span></span></code></pre></div><p>2）添加PCI设备，直通sata控制器</p><p><strong>Proxmox VE(PVE)系统直通SATA Controller(SATA 控制器)，会把整个sata总线全部直通过去，就是直接将南桥或者直接把北桥连接的sata总线直通，那么有些主板sata接口就会全部被直通。</strong></p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>如果PVE系统安装在sata硬盘中，会导致PVE无法启动，所以在直通sata控制器前要确认自己的PVE系统安装位置，或者直接安装到NVMe硬盘中</p></div></li></ol><p>​ <img src="https://storyxc.com/images/blog/image-20220425090446637.png" alt="image-20220425090446637"></p><ol start="3"><li>删除直通设备</li></ol><p><code>qm set vm编号 -delete 设备名</code>，例如要删除设备ID为100的虚拟机下直通的sata1</p><p>那就是<code>qm set 100 -delete sata1</code></p>`,36)]))}const c=a(p,[["render",l]]);export{g as __pageData,c as default};
